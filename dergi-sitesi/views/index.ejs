<%- include('./partials/header.ejs') %>
<%- include('./partials/loader.ejs') %>
<div class="custom-container">
    <div class="announcement-panel">
        <h2 class="announcement-title"><%= announcement.title %></h2>
        <p class="announcement-description"><%= announcement.description %></p>
    </div>
    
    <!-- Kategori Filtreleme Butonu -->
    <div class="custom-row card-panel">
        <div class="sidebar close">
            <div class="logo-details">
                <img src="/images/logoRemovedBackground.png" alt="" width="100px" height="100px">
            </div>
            <ul class="nav-links">
              <li>
                <a href="/">
                  <i class='bx bx-grid-alt' ></i>
                  <span class="link_name">Anasayfa</span>
                </a>
                <ul class="sub-menu blank">
                  <li><a class="link_name" href="#">Kategoriler</a></li>
                </ul>
              </li>
              <li>
                <div class="iocn-link">
                  <a href="#">
                    <i class='bx bx-collection' ></i>
                    <span class="link_name">Kategoriler</span>
                  </a>
                  <i class='bx bxs-chevron-down arrow' ></i>
                </div>
                <ul class="sub-menu">
                  <li><a class="link_name" href="#">Kategoriler</a></li>
                  <li><a href="#">HTML & CSS</a></li>
                  <li><a href="#">JavaScript</a></li>
                  <li><a href="#">PHP & MySQL</a></li>
                </ul>
                
                
                <% kategoritabs.forEach(kategoritab => { %>
                    <ul class="sub-menu blank">
                        <li><a class="link_name" href="#"><%= kategoritab.kategori_tab_ad %></a></li>
                      </ul>
                    </li>
                    <li>
                      <div class="iocn-link">
                        <a href="#">
                          <i class='bx bx-collection' ></i>
                          <span class="link_name"><%= kategoritab.kategori_tab_ad %></span>
                        </a>
                        <i class='bx bxs-chevron-down arrow' ></i>
                      </div>
                      <ul class="sub-menu">
                          <li><a class="link_name"></a></li>
                          <% kategoritab.kategoriler.forEach(kategori => { %>
                            <% if (kategori.kategoriler_tab && Array.isArray(kategori.kategoriler_tab)) { %>
                                <% kategori.kategoriler_tab.forEach(altKategori => { %>
                                    <li data-kategori="<%=altKategori.kategori_low %>"><a><%= altKategori.kategori_ad %></a></li>
                                <% }); %>
                            <% } else { %>
                                <li>No subcategories found</li>
                            <% } %>
                        <% }); %>
                      </ul>
                <% }); %>
              
              
    
        </ul>
          </div>
          <section class="home-section">
            <div class="home-content">
              <i class='bx bx-menu' ></i>
              <span class="text">Filtreler</span>
            </div>
          </section>
          <h2>Yeni Çıkan Dergilerimiz</h2>
          <div class="custom-card-container">
              <% dergiler.forEach(dergi => { %>
                  <a class="custom-card <%= dergi.kategorisi %> tumu" href="/dergiler/<%= dergi.dergi_id %>">
                      <div class="">
                          <img src="./uploads/<%= dergi.resim %>" alt="<%= dergi.baslik %>">
                          <span class="<%= dergi.kategorisi %>"></span>
                          <div class="custom-card-content">
                          <h5 class="custom-card-title"><%= dergi.dergi_basligi %></h5>
                          <p class="custom-card-text"><%= dergi.aciklama.substring(0, 80) %>...</p>
                      </div>
                  </div>
              </a>
                  <% }); %>
              </div>
      </div>
    </div>
</div>

<script>

             let arrow = document.querySelectorAll(".arrow");
          for (var i = 0; i < arrow.length; i++) {
              arrow[i].addEventListener("click", (e)=>{
                  let arrowParent = e.target.parentElement.parentElement;//selecting main parent of arrow
                  arrowParent.classList.toggle("showMenu");
                });
            }
            let sidebar = document.querySelector(".sidebar");
            let sidebarBtn = document.querySelector(".bx-menu");
            console.log(sidebarBtn);
            sidebarBtn.addEventListener("click", ()=>{
                sidebar.classList.toggle("close");
            });
    document.getElementById('kategori-toggle').addEventListener('click', function () {
        // Kategorilerin görünürlüğünü değiştir
        var kategoriListesi = document.querySelector('.filter-categorys');
        kategoriListesi.classList.toggle('active');
    });

    // Filtreleme fonksiyonu
    document.querySelectorAll('.filter-li').forEach(function (kategoriItem) {
        kategoriItem.addEventListener('click', function () {
            // Seçilen kategori adını al
            var secilenKategori = kategoriItem.getAttribute('data-kategori');

            // Filtreleme fonksiyonunu çağır
            filtrele(secilenKategori);
        });
    });
    function filtrele(kategori) {
        // Tüm kartları gizle
        document.querySelectorAll('.custom-card').forEach(function (dergiKarti) {
            dergiKarti.style.display = 'none';
        });

        // Seçilen kategoriye ait kartları göster
        document.querySelectorAll('.' + kategori).forEach(function (dergiKarti) {
            dergiKarti.style.display = 'block';
        });

        // Kategorilerin görünürlüğünü kapat
        var kategoriListesi = document.querySelector('.filter-categorys');
        kategoriListesi.classList.remove('active');
    }

    // Kategori seçildiğinde filtreleme yap
</script>

<%- include('./partials/footer.ejs') %>
